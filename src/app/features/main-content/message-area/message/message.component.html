<section [class.row-reverse]="message.mSenderId === activeUserId">
  <img src="/assets/img/{{ senderData?.uUserImage }}" alt="" />

  <div
    class="message"
    [class.user-message]="message.mSenderId === activeUserId"
  >
    <div>
      <h3 (click)="openProfil()">{{ senderData?.uName }}</h3>
      <h5>{{ getTimeInHours(message.mTime) }} Uhr</h5>
    </div>

    <div class="message-text">{{ message.mText }}</div>

    <div>
      @if (groupedReactions && groupedReactions.length > 0) {
      <span class="reaction-field">
        @for (reaction of groupedReactions.slice(0,shownReactionNumber); track
        reaction.reaction) {

        <div class="single-reaction">
          <div class="reaction-details">
            <span>{{ reaction.reaction }}</span>
            <div>{{ reaction.namesLine }}</div>
            <p>{{ reaction.actionLine }}</p>
          </div>

          <span (click)="addReaction(reaction.reaction)"
            >{{ reaction.reaction }} {{ reaction.count }}</span
          >
        </div>

        } @if (groupedReactions.length > shownReactionNumber) {
        <div (click)="setShownReactionNumber()">
          +{{ groupedReactions.length - shownReactionNumber }} weitere
        </div>
        } @if (groupedReactions.length === shownReactionNumber &&
        shownReactionNumber > 7) {
        <div (click)="setShownReactionNumber()">Weniger anzeigen</div>
        }
        <span class="material-symbols" (click)="toggleEmojiPicker($event)"
          >add_reaction</span
        >
      </span>
      } @if (message.mThreadId && chatType !== 'thread') {
      <h4>2 Antworten</h4>
      <h5>Letzte Antwort 14:56 Uhr</h5>
      }
    </div>
  </div>

  <div
    class="message-actions"
    [class.always]="isOptionsOpen"
    [class.user-message-actions]="message.mSenderId === activeUserId"
  >
    @for (reaction of activeUserData?.uLastReactions; track reaction) {
    <span (click)="addReaction(reaction)">{{ reaction }}</span>
    }

    <span
      #emojiBtn
      class="material-symbols action-btn"
      (click)="toggleEmojiPicker($event)"
    >
      add_reaction
    </span>

    <div class="material-symbols action-btn">comment</div>

    <div
      #optionsBtn
      class="material-symbols action-btn"
      [class.d-none]="message.mSenderId != activeUserId"
      (click)="toggleOptions($event)"
    >
      more_vert
    </div>

    @if (isOptionsOpen) {
    <div
      #optionsMenu
      class="options-menu"
      [class.active-user-options]="message.mSenderId === activeUserId"
    >
      <div>Nachricht bearbeiten</div>
      <div (click)="togglePermanentDelete()">Nachricht l√∂schen</div>
    </div>
    }
  </div>

  @if(isEmojiPickerOpen) {<emoji-mart
    #emojiPicker
    (emojiClick)="onEmojiPicked($event)"
    [class.active-user-emoji]="message.mSenderId === activeUserId"
  ></emoji-mart
  >}
</section>
@if (isPermanentDeleteOpen) {
<app-permanent-delete
  [target]="'message'"
  [id]="message.mId"
  (close)="isPermanentDeleteOpen = false"
></app-permanent-delete>

}
